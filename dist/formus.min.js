!function(){var e=angular.module("formus",[]);e.provider("FormusConfig",function(e){var n=function(){return{}},t={form:function(){return{title:"",name:"",fieldset:{fields:[]},data:{},config:{readonly:!1,buttons:[],"class":"padding-top-10",submit:{"class":"btn btn-default",title:"Save",handler:function(){}}}}},fieldset:function(){return{}},checkbox:function(){return{showLabel:!1,trueValue:!0,falseValue:!1}},radio:function(){return{inline:!0}},radio:function(){return{horizontal:!1}},group:function(){return{"class":"bordered"}},file:function(){return{showLink:!0}}},i=function(n,i){"function"!=typeof i&&e.warn("Config must be callback"),t[n]=i},o=function(e){var i=function(i){return t[i]?t[i]():(e.info("Don't find config for input \""+i+'"'),n())};return{get:i}};return{set:i,$get:["$log",o]}}),e.provider("FormusContainer",function(){var e,n,t,i={};this.setContainer=function(e){i=e};var o=function(o){var r={};return"undefined"==typeof o?e.error("Don't set form configuration name "):i[o]?(r=i[o],r.name||(r.name=o)):e.error('Form configuration with name "'+o+"\" don't found in configuration container"),n.extendDeep(angular.copy(t),angular.copy(r))},r=this.set=function(e,n){i[e]=n};this.$get=["$log","FormusConfig","FormusHelper",function(i,a,l){return t=a.get("form"),e=i,n=l,{get:o,set:r}}]}),e.directive("formusField",function(e,n,t,i,o,r,a,l){return{transclude:!0,restrict:"E",require:"ngModel",scope:{config:"=",parentErrors:"=errors",ngModel:"="},link:function(n,t,i,o){n.isValid=!0,n.validation=function(e){if("object"==typeof n.config.validators){var t=[];angular.forEach(n.config.validators,function(i,o){var r=a.validate(o,e,n.config,i);null!==r&&"string"==typeof r&&t.push(r)}),t.length>0?(n.error=t,n.isValid=!1):(n.error=null,n.isValid=!0)}};var f=function(){n.$watch("parentErrors",function(e){angular.isDefined(e)&&(n.isParent?n.errors=l.getNested(e,n.config.name,n.errors):n.error=l.getNested(e,n.config.name,n.error))},!0),n.isParent?n.$watch("errors",function(e){angular.isDefined(e)&&(n.parentErrors=e)},!0):n.$watch("error",function(e){angular.isDefined(e)&&(n.config.name?(angular.isObject(n.parentErrors)||(n.parentErrors={}),n.parentErrors[n.config.name]=e):n.parentErrors=e)},!0)};n.$on("Formus.validate",function(){n.config.hide?(n.error=null,n.isValid=!0):n.validation(n.model),n.$emit("Formus.validated",n.isValid)}),n.init=function(){n.isParent="undefined"!=typeof n.config.fields,n.isParent&&"undefined"==typeof n.config.input&&(n.config.input="fieldset"),n.$watch("ngModel",function(e){var t;angular.isDefined(e)&&angular.isDefined(t=l.getNested(e,n.config.name))&&(n.model=t)},!0),n.$watch("model",function(e){if(angular.isDefined(o.$modelValue)){var t=l.getNested(o.$modelValue,n.config.name);angular.isDefined(t)&&t!==e&&(l.setNested(o.$modelValue,n.config.name,e),o.$dirty=!0),o.$dirty&&n.validation(e)}},!0),f(),r.call(n.config.input,{$scope:n,$element:t,$attr:i,$ngModelCtrl:o}),"function"==typeof n.config.linker&&e.invoke(n.config.linker,this,{$scope:n,$element:t,$attr:i,$ngModelCtrl:o}),n.$watch("config.hide",function(e){e?t.hide():t.show()})};var u=n.$watch("config",function(){angular.isDefined(n.config)&&(n.init(),u())},!0)},controller:function(){}}}),e.directive("formusForm",function(e,n,t){return{transclude:!0,replace:!0,restrict:"E",scope:{name:"@",fieldset:"=",errors:"=?",model:"=",config:"="},templateUrl:t.getUrl("form"),link:function(e,t,i){n.formLinker({$scope:e,$element:t,$attr:i})},controller:function(n,t,i){n.validate=function(){var i=e.defer(),o=t.find("formus-field").length,r=0,a=!1,l=function(e,n){r++,a=n?a:!0,r===o&&(a?i.reject():i.resolve())};return n.$on("Formus.validated",l),n.$broadcast("Formus.validate"),i.promise},n.submit=function(){n.validate().then(function(){"function"==typeof n.config.submit.handler&&n.config.submit.handler()},angular.noop)},i.$on("Formus.validateForm",function(e,t){t===n.name&&n.validate().then(function(){i.$emit("Formus.validatedForm",!0)},function(){i.$emit("Formus.validatedForm",!1)})})}}}),e.factory("FormusHelper",function(){var e=function(e){var n={};return angular.forEach(e.data,function(e){this[e.field]=[e.message]},n),n},n=function a(e){return angular.forEach(arguments,function(n){n!==e&&angular.forEach(n,function(n,t){angular.isDefined(e[t])&&e[t].constructor&&e[t].constructor===Object&&"object"==typeof e[t]&&"object"==typeof n?a(e[t],n):e[t]=n})}),e},t=function(e,n,i){if(n){angular.isObject(e)||(e={});var o=n.split(".");return o.length>1?t(e[o[0]],o.splice(1,o.length).join("."),i):(e[n]=i,i)}return e=i,i},i=function(e,n,t){if(t=angular.isDefined(t)?t:void 0,angular.isDefined(e)){if(n){var o=n.split(".");return o.length>1?i(e[o[0]],o.splice(1,o.length).join("."),t):i(e[n],!1,t)}return e}return t},o=function(e,n){var t=n.name;if(t){var i=e,r=t.split(".");if(r.length>1){for(var a=0;a<r.length-1;a++){var l=r[a];angular.isUndefined(i[l])&&(i[l]={}),i=i[l]}t=r[r.length-1]}angular.isUndefined(i[t])&&(i[t]=n.fields?{}:""),angular.isDefined(n.default)&&(i[t]=n.default),n.fields&&_.each(n.fields,function(e){i[t]=o(i[t],e)})}else angular.isUndefined(e)&&(e=n.fields?{}:""),angular.isDefined(n.default)&&(e=n.default),n.fields&&_.each(n.fields,function(n){e=o(e,n)});return e},r=function(e,n,t,i){var o=[];return 4===arguments.length&&angular.isDefined(i)&&(e=e[i]),_.each(e,function(e){o.push({value:e[n],title:e[t]})}),o};return{setNested:t,getNested:i,initModel:o,extendDeep:n,extractBackendErrors:e,extractItems:r}}),e.provider("FormusLinker",function(){function e(e,n){return{call:function(t,i){e.invoke(o.default,null,i),o.hasOwnProperty(t)?e.invoke(o[t],null,i):n.info("Don't find linker for input \""+t+'"'),e.invoke(o.loadTemplate,null,i)},formLinker:function(n){e.invoke(o.form,null,n)}}}var n=function(e,n,t,i,o){if(e.config){e.setElementTemplate=function(i){n.html(i),t(n.contents())(e),"function"==typeof e.afterLoadTemplate&&e.afterLoadTemplate()};var r=e.config.template;if(r)e.setElementTemplate(r);else{var a=e.config.templateName;if(a&&i.has(a))i.get(a).then(function(n){e.setElementTemplate(n)},function(){o.error("Template type '"+a+"' not supported.")});else{var l=e.config.templateUrl;if(l)i.load(l).then(function(n){e.setElementTemplate(n)},null);else{var f=e.config.input;f&&i.has(f)&&i.get(f).then(function(n){e.setElementTemplate(n)},function(){o.error("Template type '"+f+"' not supported.")})}}}}},t=function(e,n){var t=n.get(e.config.input);_.each(t,function(n,t){angular.isUndefined(e.config[t])&&(e.config[t]=n)}),e.config.label&&"undefined"==typeof e.config.showLabel&&(e.config.showLabel=!0)},i=function(e,n){var t=e.$watch("fieldset",function(){"undefined"!=typeof e.fieldset&&(e.model=n.initModel(e.model,e.fieldset),e.errors=e.errors||{},t())})},o={loadTemplate:n,"default":t,form:i,wrapperLinker:n};return{setLinker:function(e,n){o[e]=n},$get:["$injector","$log",function(n,t){return e(n,t)}]}}),e.provider("FormusTemplates",function(){var e,n,t,i,o={form:"formus/form.html",wrapper:"formus/inputs/wrapper.html",radio:"formus/inputs/radio.html",checkbox:"formus/inputs/checkbox.html",checklist:"formus/inputs/checklist.html",hidden:"formus/inputs/hidden.html",select:"formus/inputs/select.html",textarea:"formus/inputs/textarea.html",textbox:"formus/inputs/textbox.html",fieldset:"formus/inputs/fieldset.html",message:"formus/inputs/message.html",label:"formus/inputs/label.html"},r=function(e,n){"string"==typeof e?o[e]=n:angular.forEach(e,function(e,n){r(n,e)})},a=function(e){return"undefined"!=typeof o[e]},l=function(e){return o[e]},f=function(o){var r=e.defer();return t.get(o,{cache:n}).then(function(e){r.resolve(e.data)},function(){i.error("Problem with loading template for "+o),r.reject()}),r.promise},u=function(e){return f(l(e))};return{setTemplateUrl:r,$get:["$q","$http","$templateCache","$log",function(o,r,s,c){return e=o,t=r,n=s,i=c,{has:a,get:u,load:f,getUrl:l}}]}}),e.provider("FormusValidator",function(e){var n={required:function(e,n){return e?null:n.label+" cannot be blank"}},t=function(e){function t(e){return n[e]?n[e]:void 0}function i(t,i,o,r){return n[t]?n[t](i,o,r):(e.warn("Don't find validator with name \""+t+'"'),null)}return{get:t,validate:i}},i=function(t,i){"function"==typeof i?n[t]=i:e.warn("Validator must be function. Can't set validator with name \""+t+'"')};return{set:i,$get:t}}),e.directive("formusWrapper",function(e){return{restrict:"AE",transclude:!0,templateUrl:e.getUrl("wrapper"),link:{post:function(e){e.input=e.$$childHead.$$childHead}}}})}(),angular.module("formus").run(["$templateCache",function(e){e.put("formus/form.html",'<form role=form id={{name}} class={{config.class}} style={{config.style}} ng-submit=submit()><header><div ng-if=config.showErrors></div></header><formus-field ng-model=model errors=errors config=fieldset></formus-field><footer><div ng-repeat="btn in config.buttons" class=pull-left><button class={{btn.class}} type=button ng-if=!btn.items ng-click=btn.handler()>{{btn.title}}</button><div class="btn-group margin-left-5" ng-if=btn.items><button class="{{btn.class}} dropdown-toggle" type=button data-toggle=dropdown>{{btn.title}} <span class=caret></span></button><ul class=dropdown-menu><li ng-repeat="item in btn.items"><a ng-click=item.handler()>{{item.title}}</a></li></ul></div></div><button ng-if=config.submit type=submit class={{config.submit.class}} ng-bind=config.submit.title></button></footer></form>'),e.put("formus/inputs/checkbox.html","<div class=checkbox><label><input type=checkbox ng-true-value={{config.trueValue}} ng-false-value={{config.falseValue}} ng-model=model name={{config.name}}>{{config.label}}</label></div>"),e.put("formus/inputs/fieldset.html",'<div class=row><formus-wrapper ng-repeat="field in config.fields" class={{config.wrapClass}}><formus-field ng-model=model errors=errors config=field></formus-field></formus-wrapper></div>'),e.put("formus/inputs/radio.html",'<div ng-if=!config.inline><div class=radio ng-repeat="item in config.items"><label><input ng-value=item.value name={{name}} type=radio ng-model=$parent.model>{{item.title}}</label></div></div><div ng-if=config.inline><label class="radio radio-inline" ng-repeat="item in config.items"><input ng-value=item.value name={{name}} type=radio ng-model=$parent.model>{{item.title}}</label></div>'),e.put("formus/inputs/select.html",'<select name={{config.name}} ng-model=model class=form-control style={{config.style}} id={{config.name}} ng-options="item.value as item.title for item in config.items"><option value ng-if=config.empty>{{config.empty}}</option></select>'),e.put("formus/inputs/textarea.html","<textarea ng-readonly=config.readonly class=form-control placeholder={{config.placeholder?config.placeholder:config.label}} rows={{config.rows}} ng-model=model name={{config.name}} id={{config.name}} style={{config.style}}></textarea>"),e.put("formus/inputs/textbox.html","<div ng-class=\"{'input-group': config.addon}\"><div class=input-group-addon ng-if=config.addon ng-bind=config.addon></div><input ng-readonly=config.readonly ng-model=model class=form-control id={{config.name}} name={{config.name}} placeholder={{config.placeholder?config.placeholder:config.label}}></div>"),e.put("formus/inputs/wrapper.html",'<div class="form-group margin-bottom-5 col-md-12" ng-class="{\'has-error\': input.error}"><label for={{input.config.name}} ng-show=input.config.showLabel ng-bind=input.config.label></label><div ng-transclude></div><span class=help-block ng-repeat="e in input.error" ng-bind=e></span></div>')}]);