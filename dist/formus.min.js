!function(){var e=angular.module("formus",[]);e.provider("FormusConfig",function(e){var n=function(){return{}},t={form:function(){return{title:"",name:"",fieldset:{wrapClass:"col-md-12",fields:[]},data:{},config:{readonly:!1,buttons:[],"class":"padding-top-10",submit:{"class":"btn btn-default",title:"Save",handler:function(){}}}}},fieldset:function(){return{wrapClass:"col col-6"}},checkbox:function(){return{trueValue:!0,falseValue:!1}},radio:function(){return{horizontal:!1}},group:function(){return{"class":"bordered"}},file:function(){return{showLink:!0}}},o=function(n,o){"function"!=typeof o&&e.warn("Config must be callback"),t[n]=o},r=function(e){var o=function(o){return t[o]?t[o]():(e.info("Don't find config for input \""+o+'"'),n())};return{get:o}};return{set:o,$get:["$log",r]}}),e.provider("FormusContainer",function(){var e,n,t,o={};this.setContainer=function(e){o=e};var r=function(r){var i={};return"undefined"==typeof r?e.error("Don't set form configuration name "):o[r]?(i=o[r],i.name||(i.name=r)):e.error('Form configuration with name "'+r+"\" don't found in configuration container"),n.extendDeep(angular.copy(t),angular.copy(i))},i=this.set=function(e,n){o[e]=n};this.$get=["$log","FormusConfig","FormusHelper",function(o,a,l){return t=a.get("form"),e=o,n=l,{get:r,set:i}}]}),e.directive("formusField",function(e,n,t,o,r,i,a,l){return{transclude:!0,replace:!0,restrict:"E",require:"ngModel",scope:{config:"=",parentErrors:"=errors",ngModel:"="},link:function(n,t,o,r){n.isValid=!0,n.validation=function(e){if("object"==typeof n.config.validators){var t=[];angular.forEach(n.config.validators,function(o,r){var i=a.validate(r,e,n.config,o);null!==i&&"string"==typeof i&&t.push(i)}),t.length>0?(n.error=t,n.isValid=!1):(n.error=null,n.isValid=!0)}};var f=function(){n.$watch("parentErrors",function(e){angular.isDefined(e)&&(n.isParent?n.errors=l.getNested(e,n.config.name,n.errors):n.error=l.getNested(e,n.config.name,n.error))},!0),n.isParent?n.$watch("errors",function(e){angular.isDefined(e)&&(n.parentErrors=e)},!0):n.$watch("error",function(e){angular.isDefined(e)&&(n.config.name?(angular.isObject(n.parentErrors)||(n.parentErrors={}),n.parentErrors[n.config.name]=e):n.parentErrors=e)},!0)};n.$on("Formus.validate",function(){n.config.hide?(n.error=null,n.isValid=!0):n.validation(n.model),n.$emit("Formus.validated",n.isValid)}),n.init=function(){n.isParent="undefined"!=typeof n.config.fields,n.isParent&&"undefined"==typeof n.config.input&&(n.config.input="fieldset"),n.$watch("ngModel",function(e){var t;angular.isDefined(e)&&angular.isDefined(t=l.getNested(e,n.config.name))&&(n.model=t)},!0),n.$watch("model",function(e){if(angular.isDefined(r.$modelValue)){var t=l.getNested(r.$modelValue,n.config.name);angular.isDefined(t)&&t!==e&&(l.setNested(r.$modelValue,n.config.name,e),r.$dirty=!0),r.$dirty&&n.validation(e)}},!0),f(),i.call(n.config.input,{$scope:n,$element:t,$attr:o,$ngModelCtrl:r}),"function"==typeof n.config.linker&&e.invoke(n.config.linker,this,{$scope:n,$element:t,$attr:o,$ngModelCtrl:r}),n.$watch("config.hide",function(e){e?t.hide():t.show()})};var s=n.$watch("config",function(){angular.isDefined(n.config)&&(n.init(),s())},!0)},controller:function(){}}}),e.directive("formusForm",function(e,n,t){return{transclude:!0,replace:!0,restrict:"E",scope:{name:"@",fieldset:"=",errors:"=?",model:"=",config:"="},templateUrl:t.getUrl("form"),link:function(e,t,o){n.formLinker({$scope:e,$element:t,$attr:o})},controller:function(n,t,o){n.validate=function(){var o=e.defer(),r=t.find("formus-field").length,i=0,a=!1,l=function(e,n){i++,a=n?a:!0,i===r&&(a?o.reject():o.resolve())};return n.$on("Formus.validated",l),n.$broadcast("Formus.validate"),o.promise},n.submit=function(){n.validate().then(function(){"function"==typeof n.config.submit.handler&&n.config.submit.handler()},angular.noop)},o.$on("Formus.validateForm",function(e,t){t===n.name&&n.validate().then(function(){o.$emit("Formus.validatedForm",!0)},function(){o.$emit("Formus.validatedForm",!1)})})}}}),e.factory("FormusHelper",function(){var e=function(e){var n={};return angular.forEach(e.data,function(e){this[e.field]=[e.message]},n),n},n=function i(e){return angular.forEach(arguments,function(n){n!==e&&angular.forEach(n,function(n,t){angular.isDefined(e[t])&&e[t].constructor&&e[t].constructor===Object&&"object"==typeof e[t]&&"object"==typeof n?i(e[t],n):e[t]=n})}),e},t=function(e,n,o){if(n){angular.isObject(e)||(e={});var r=n.split(".");return r.length>1?t(e[r[0]],r.splice(1,r.length).join("."),o):(e[n]=o,o)}return e=o,o},o=function(e,n,t){if(t=angular.isDefined(t)?t:void 0,angular.isDefined(e)){if(n){var r=n.split(".");return r.length>1?o(e[r[0]],r.splice(1,r.length).join("."),t):o(e[n],!1,t)}return e}return t},r=function(e,n){var t=n.name;if(t){var o=e,i=t.split(".");if(i.length>1){for(var a=0;a<i.length-1;a++){var l=i[a];angular.isUndefined(o)&&(o={}),o=o[l]}angular.isUndefined(o)&&(o={}),t=i[i.length-1]}angular.isUndefined(o[t])&&(o[t]=n.fields?{}:""),angular.isDefined(n.default)&&(o[t]=n.default),n.fields&&_.each(n.fields,function(n){r(e[t],n)})}else angular.isUndefined(e)&&(e=n.fields?{}:""),angular.isDefined(n.default)&&(e=n.default),n.fields&&_.each(n.fields,function(n){r(e,n)});return e};return{setNested:t,getNested:o,initModel:r,extendDeep:n,extractBackendErrors:e}}),e.provider("FormusLinker",function(){function e(e,n){return{call:function(t,o){e.invoke(r.default,null,o),r.hasOwnProperty(t)?e.invoke(r[t],null,o):n.info("Don't find linker for input \""+t+'"'),e.invoke(r.loadTemplate,null,o)},formLinker:function(n){e.invoke(r.form,null,n)}}}var n=function(e,n,t,o,r){if(e.config){e.setElementTemplate=function(o){n.html(o),t(n.contents())(e),"function"==typeof e.afterLoadTemplate&&e.afterLoadTemplate()};var i=e.config.template;if(i)e.setElementTemplate(i);else{var a=e.config.templateName;if(a&&o.has(a))o.get(a).then(function(n){e.setElementTemplate(n)},function(){r.error("Template type '"+a+"' not supported.")});else{var l=e.config.templateUrl;if(l)o.load(l).then(function(n){e.setElementTemplate(n)},null);else{var f=e.config.input;f&&o.has(f)&&o.get(f).then(function(n){e.setElementTemplate(n)},function(){r.error("Template type '"+f+"' not supported.")})}}}}},t=function(e,n){var t=n.get(e.config.input);_.each(t,function(n,t){angular.isUndefined(e.config[t])&&(e.config[t]=n)}),e.config.label&&"undefined"==typeof e.config.showLabel&&(e.config.showLabel=!0)},o=function(e,n){var t=e.$watch("fieldset",function(){"undefined"!=typeof e.fieldset&&(e.model=n.initModel(e.model,e.fieldset),e.errors=e.errors||{},t())})},r={loadTemplate:n,"default":t,form:o};return{setLinker:function(e,n){r[e]=n},$get:["$injector","$log",function(n,t){return e(n,t)}]}}),e.provider("FormusTemplates",function(){var e,n,t,o,r={form:"formus/form.html",radio:"formus/inputs/radio.html",checkbox:"formus/inputs/checkbox.html",checklist:"formus/inputs/checklist.html",hidden:"formus/inputs/hidden.html",select:"formus/inputs/select.html",textarea:"formus/inputs/textarea.html",textbox:"formus/inputs/textbox.html",fieldset:"formus/inputs/fieldset.html",message:"formus/inputs/message.html",label:"formus/inputs/label.html"},i=function(e,n){"string"==typeof e?r[e]=n:angular.forEach(e,function(e,n){i(n,e)})},a=function(e){return"undefined"!=typeof r[e]},l=function(e){return r[e]},f=function(r){var i=e.defer();return t.get(r,{cache:n}).then(function(e){i.resolve(e.data)},function(){o.error("Problem with loading template for "+r),i.reject()}),i.promise},s=function(e){return f(l(e))};return{setTemplateUrl:i,$get:["$q","$http","$templateCache","$log",function(r,i,u,c){return e=r,t=i,n=u,o=c,{has:a,get:s,load:f,getUrl:l}}]}}),e.provider("FormusValidator",function(e){var n={required:function(e,n){return e?null:n.label+" cannot be blank"}},t=function(e){function t(e){return n[e]?n[e]:void 0}function o(t,o,r,i){return n[t]?n[t](o,r,i):(e.warn("Don't find validator with name \""+t+'"'),null)}return{get:t,validate:o}},o=function(t,o){"function"==typeof o?n[t]=o:e.warn("Validator must be function. Can't set validator with name \""+t+'"')};return{set:o,$get:t}})}(),angular.module("formus").run(["$templateCache",function(e){e.put("formus/form.html",'<form role="form" id="{{name}}" class="{{config.class}}" style="{{config.style}}" ng-submit="submit()"> <formus-field ng-model="model" errors="errors" config="fieldset"></formus-field> <footer> <div ng-repeat="btn in config.buttons" class="pull-left"> <button class="btn {{ btn.class }}" type="button" ng-if="!btn.items" ng-click="btn.handler()"> {{ btn.title }} </button> <div class="btn-group margin-left-5" ng-if="btn.items"> <button class="btn {{btn.class}} dropdown-toggle" type="button" data-toggle="dropdown"> {{btn.title}} <span class="caret"></span> </button> <ul class="dropdown-menu"> <li ng-repeat="item in btn.items"><a ng-click="item.handler()">{{item.title}}</a> </li> </ul> </div> </div> <button ng-if="config.submit" type="submit" class="{{config.submit.class}}" ng-bind="config.submit.title"></button> </footer></form>'),e.put("formus/inputs/checkbox.html",'<div class="form-group" ng-class="{\'has-error\':error}"><div class="checkbox"> <label> <input type="checkbox" ng-true-value="{{config.trueValue}}" ng-false-value="{{config.falseValue}}" ng-model="model" name="{{config.name}}">{{config.label}} </label></div><span class="help-block" ng-repeat="e in error" ng-bind="e"></span></div>'),e.put("formus/inputs/fieldset.html",'<div class="row"> <div ng-repeat="field in config.fields" class="{{config.wrapClass}}"> <formus-field ng-model="model" errors="errors" config="field"></formus-field> </div></div>'),e.put("formus/inputs/select.html",'<div class="form-group" ng-class="{\'has-error\':error}"><label for="{{config.name}}" ng-show="config.showLabel" ng-bind="config.label"></label><select name="{{config.name}}" ng-model="model" class="form-control" style="{{config.style}}" id="{{config.name}}" ng-options="item.value as item.title for item in config.items"> <option value="" ng-if="config.empty">{{config.empty}}</option></select><span class="help-block" ng-repeat="e in error" ng-bind="e"></span></div>'),e.put("formus/inputs/textarea.html",'<div class="form-group" ng-class="{\'has-error\':error}"><label for="{{config.name}}" ng-show="config.showLabel" ng-bind="config.label"></label><textarea ng-readonly="config.readonly" class="form-control" placeholder="{{config.placeholder?config.placeholder:config.label}}" rows="{{config.rows}}" ng-model="model" name="{{config.name}}" id="{{config.name}}" style="{{config.style}}"></textarea><span class="help-block" ng-repeat="e in error" ng-bind="e"></span></div>'),e.put("formus/inputs/textbox.html",'<div class="form-group" ng-class="{\'has-error\':error}"><label for="{{config.name}}" ng-show="config.showLabel" ng-bind="config.label"></label><input ng-readonly="config.readonly" ng-model="model" class="form-control" id="{{config.name}}" name="{{config.name}}" placeholder="{{config.placeholder?config.placeholder:config.label}}"><span class="help-block" ng-repeat="e in error" ng-bind="e"></span></div>'),e.put("formus/inputs/wrapper.html","<div></div>")}]);