formus.provider("FormusConfig",function(a){var b=function(){return{}},c={form:function(){return{title:"",name:"",fieldset:{wrapClass:"col-md-12",fields:[]},data:{},config:{readonly:!1,buttons:[],"class":"padding-top-10",submit:{title:"Save",handler:function(){}}}}},fieldset:function(){return{wrapClass:"col col-6"}},radio:function(){return{horizontal:!1}},group:function(){return{"class":"bordered"}},file:function(){return{showLink:!0}}},d=function(b,d){"function"!=typeof d&&a.warn("Config must be callback"),c[b]=d},e=function(a){var d=function(d){return c[d]?c[d]():(a.info("Don't find config for input \""+d+'"'),b())};return{get:d}};return{set:d,$get:["$log",e]}}),formus.provider("FormusContainer",function(){var a,b,c,d={};this.setContainer=function(a){d=a},this.get=function(e){var f={};return"undefined"==typeof e?a.error("Don't set form configuration name "):d[e]?(f=d[e],f.name||(f.name=e)):a.error('Form configuration with name "'+e+"\" don't found in configuration container"),b.extendDeep(angular.copy(c),angular.copy(f))},this.$get=["$log","FormusConfig","FormusHelper",function(d,e,f){return c=e.get("form"),a=d,b=f,this}]}),formus.directive("formusField",function(a,b,c,d,e,f,g,h){return{transclude:!0,replace:!0,restrict:"E",require:"ngModel",scope:{config:"=",parentErrors:"=errors",ngModel:"="},link:function(b,c,d,e){b.isValid=!0,b.validation=function(a){if("object"==typeof b.config.validators){var c=[];angular.forEach(b.config.validators,function(d,e){var f=g.validate(e,a,b.config,d);null!==f&&"string"==typeof f&&c.push(f)}),c.length>0?(b.error=c,b.isValid=!1):(b.error=null,b.isValid=!0)}};var i=function(){b.$watch("parentErrors",function(a){angular.isDefined(a)&&(b.isParent?b.errors=h.getNested(a,b.config.name,b.errors):b.error=h.getNested(a,b.config.name,b.error))},!0),b.isParent?b.$watch("errors",function(a){angular.isDefined(a)&&(b.parentErrors=a)},!0):b.$watch("error",function(a){angular.isDefined(a)&&(b.config.name?(angular.isObject(b.parentErrors)||(b.parentErrors={}),b.parentErrors[b.config.name]=a):b.parentErrors=a)},!0)};b.$on("Formus.validate",function(){b.config.hide?(b.error=null,b.isValid=!0):b.validation(b.model),b.$emit("Formus.validated",b.isValid)}),b.init=function(){b.isParent="undefined"!=typeof b.config.fields,b.isParent&&"undefined"==typeof b.config.input&&(b.config.input="fieldset"),b.$watch("ngModel",function(a){var c;angular.isDefined(a)&&angular.isDefined(c=h.getNested(a,b.config.name))&&(b.model=c)},!0),b.$watch("model",function(a){if(angular.isDefined(e.$modelValue)){var c=h.getNested(e.$modelValue,b.config.name);angular.isDefined(c)&&c!==a&&(h.setNested(e.$modelValue,b.config.name,a),e.$dirty=!0),e.$dirty&&b.validation(a)}},!0),i(),f.call(b.config.input,{$scope:b,$element:c,$attr:d,$ngModelCtrl:e}),"function"==typeof b.config.linker&&a.invoke(b.config.linker,this,{$scope:b,$element:c,$attr:d,$ngModelCtrl:e}),b.$watch("config.hide",function(a){a?c.hide():c.show()})};var j=b.$watch("config",function(){angular.isDefined(b.config)&&(b.init(),j())},!0)},controller:function(){}}}),formus.directive("formusForm",function(a,b){return{transclude:!0,replace:!0,restrict:"E",scope:{name:"@",fieldset:"=",errors:"=?",model:"=",config:"="},templateUrl:"views/formus/form.html",link:function(a,c,d){b.formLinker({$scope:a,$element:c,$attr:d})},controller:function(b,c){b.validate=function(){var d=a.defer(),e=c.find("formus-field").length,f=0,g=!1,h=function(a,b){f++,g=b?g:!0,f===e&&(g?d.reject():d.resolve())};return b.$on("Formus.validated",h),b.$broadcast("Formus.validate"),d.promise},b.submit=function(){b.validate().then(function(){"function"==typeof b.config.submit.handler&&b.config.submit.handler()},angular.noop)},$rootScope.$on("Formus.validateForm",function(a,c){c===b.name&&b.validate().then(function(){$rootScope.$emit("Formus.validatedForm",!0)},function(){$rootScope.$emit("Formus.validatedForm",!1)})})}}});var formus=angular.module("formus",[]);formus.factory("FormusHelper",function(){var a=function(a){var b={};return angular.forEach(a.data,function(a){this[a.field]=[a.message]},b),b},b=function f(a){return angular.forEach(arguments,function(b){b!==a&&angular.forEach(b,function(b,c){angular.isDefined(a[c])&&a[c].constructor&&a[c].constructor===Object&&"object"==typeof a[c]&&"object"==typeof b?f(a[c],b):a[c]=b})}),a},c=function(a,b,d){if(b){angular.isObject(a)||(a={});var e=b.split(".");return e.length>1?c(a[e[0]],e.splice(1,e.length).join("."),d):(a[b]=d,d)}return a=d,d},d=function(a,b,c){if(c=angular.isDefined(c)?c:void 0,angular.isDefined(a)){if(b){var e=b.split(".");return e.length>1?d(a[e[0]],e.splice(1,e.length).join("."),c):d(a[b],!1,c)}return a}return c},e=function(a,b){var c=b.name;if(c){var d=c.split(".");if(d.length>1){var f=a;_.each(d,function(a){"undefined"==typeof f&&(f={}),f=f[a]}),"undefined"==typeof f&&(f="undefined"==typeof b.default?b.fields?{}:"":b.default)}else"undefined"==typeof a[c]&&(a[c]="undefined"==typeof b.default?b.fields?{}:"":b.default),b.fields&&_.each(b.fields,function(b){e(a[c],b)})}else"undefined"==typeof a&&(a="undefined"==typeof b.default?b.fields?{}:"":b.default),b.fields&&_.each(b.fields,function(b){e(a,b)})};return{setNested:c,getNested:d,initModel:e,extendDeep:b,extractBackendErrors:a}}),formus.provider("FormusLinker",function(){function a(a,b){return{call:function(c,d){a.invoke(e.default,null,d),e.hasOwnProperty(c)?a.invoke(e[c],null,d):b.info("Don't find linker for input \""+c+'"'),a.invoke(e.loadTemplate,null,d)},formLinker:function(b){a.invoke(e.form,null,b)}}}var b=function(a,b,c,d,e){if(a.config){a.setElementTemplate=function(d){b.html(d),c(b.contents())(a),"function"==typeof a.afterLoadTemplate&&a.afterLoadTemplate()};var f=a.config.template;if(f)a.setElementTemplate(f);else{var g=a.config.templateName;if(g&&d.has(g))d.get(g).then(function(b){a.setElementTemplate(b)},function(){e.error("Template type '"+g+"' not supported.")});else{var h=a.config.templateUrl;if(h)d.load(h).then(function(b){a.setElementTemplate(b)},null);else{var i=a.config.input;i&&d.has(i)&&d.get(i).then(function(b){a.setElementTemplate(b)},function(){e.error("Template type '"+i+"' not supported.")})}}}}},c=function(a,b){var c=b.get(a.config.input);_.each(c,function(b,c){angular.isUndefined(a.config[c])&&(a.config[c]=b)}),a.config.label&&"undefined"==typeof a.config.showLabel&&(a.config.showLabel=!0)},d=function(a,b){var c=a.$watch("fieldset",function(){"undefined"!=typeof a.fieldset&&(b.initModel(a.model,a.fieldset),a.errors=a.errors||{},c())})},e={loadTemplate:b,"default":c,form:d};return{setLinker:function(a,b){e[a]=b},$get:["$injector","$log",function(b,c){return a(b,c)}]}}),formus.provider("FormusTemplates",function(){var a,b,c,d,e={radio:"views/formus/inputs/radio.html",checkbox:"views/formus/inputs/checkbox.html",checklist:"views/formus/inputs/checklist.html",hidden:"views/formus/inputs/hidden.html",select:"views/formus/inputs/select.html",textarea:"views/formus/inputs/textarea.html",textbox:"views/formus/inputs/textbox.html",fieldset:"views/formus/inputs/fieldset.html",message:"views/formus/inputs/message.html",datetime:"views/formus/inputs/datetime.html",label:"views/formus/inputs/label.html",ckeditor:"views/formus/inputs/ckeditor.html"},f=function(a,b){"string"==typeof a?e[a]=b:angular.forEach(a,function(a,b){f(b,a)})},g=function(a){return"undefined"!=typeof e[a]},h=function(a){return e[a]},i=function(e){var f=a.defer();return c.get(e,{cache:b}).then(function(a){f.resolve(a.data)},function(){d.error("Problem with loading template for "+e),f.reject()}),f.promise},j=function(a){return i(h(a))};return{setTemplateUrl:f,$get:["$q","$http","$templateCache","$log",function(e,f,k,l){return a=e,c=f,b=k,d=l,{has:g,get:j,load:i,getTemplateUrl:h}}]}}),formus.provider("FormusValidator",function(a){var b={required:function(a,b){return a?null:b.label+" cannot be blank"}},c=function(a){function c(a){return b[a]?b[a]:void 0}function d(c,d,e,f){return b[c]?b[c](d,e,f):(a.warn("Don't find validator with name \""+c+'"'),null)}return{get:c,validate:d}},d=function(c,d){"function"==typeof d?b[c]=d:a.warn("Validator must be function. Can't set validator with name \""+c+'"')};return{set:d,$get:c}});